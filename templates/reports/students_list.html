{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Students Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{% static 'css/report.css' %}" rel="stylesheet">
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-light mb-4">
      <div class="container">
        <a class="navbar-brand" href="/">DMS</a>
        <div class="d-flex gap-2">
          {% if user.is_superuser or 'Admin' in user_groups %}
          <a class="btn btn-primary btn-sm" href="{% url 'reports:create-student' %}">
            <i class="fas fa-plus me-1"></i>Add Student
          </a>
          {% endif %}
          <a class="btn btn-outline-secondary btn-sm" href="/accounts/dashboard/admin/">
            <i class="fas fa-arrow-left me-1"></i>Dashboard
          </a>
          <a class="btn btn-outline-secondary btn-sm" href="/accounts/logout/">Logout</a>
        </div>
      </div>
    </nav>

    <!-- Students Table -->
    <div class="container">
      <div class="card form-card p-4 mb-4">
        <h3 class="page-title mb-4">
          <i class="fas fa-users me-2" style="color: #667eea;"></i>Students Management
        </h3>

        {% if students %}
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th><i class="fas fa-image me-2"></i>Photo</th>
                  <th><i class="fas fa-user me-2"></i>Name</th>
                  <th><i class="fas fa-id-card me-2"></i>Admission #</th>
                  <th><i class="fas fa-book me-2"></i>Stream</th>
                  <th><i class="fas fa-venus-mars me-2"></i>Gender</th>
                  <th><i class="fas fa-user-tie me-2"></i>Parent</th>
                  <th class="text-end">Actions</th>
                  <th class="text-end">Report</th>
                </tr>
              </thead>
              <tbody>
                {% for student in students %}
                  <tr>
                    <td>
                      {% if student.profile_picture %}
                        <img src="{{ student.profile_picture.url }}" alt="{{ student.name }}" style="height: 50px; width: 50px; border-radius: 50%; object-fit: cover;">
                      {% else %}
                        <div style="height: 50px; width: 50px; border-radius: 50%; background: #e0e0e0; display: flex; align-items: center; justify-content: center;">
                          <i class="fas fa-user" style="color: #999;"></i>
                        </div>
                      {% endif %}
                    </td>
                    <td><strong>{{ student.name }}</strong></td>
                    <td>{{ student.admission_number }}</td>
                    <td>
                      {% if student.stream %}
                        <span class="badge bg-info">{{ student.get_stream_display }}</span>
                      {% else %}
                        <span class="text-muted">—</span>
                      {% endif %}
                    </td>
                    <td>
                      {% if student.gender %}
                        {% if student.gender == 'Male' or student.gender == 'M' %}
                          <i class="fas fa-mars" style="color: #667eea;"></i> {{ student.gender }}
                        {% else %}
                          <i class="fas fa-venus" style="color: #e94b9a;"></i> {{ student.gender }}
                        {% endif %}
                      {% else %}
                        <span class="text-muted">—</span>
                      {% endif %}
                    </td>
                    <td>
                      {% if student.parent %}
                        <span class="badge bg-success">{{ student.parent.first_name }} {{ student.parent.last_name }}</span>
                      {% else %}
                        <span class="text-muted">Unassigned</span>
                      {% endif %}
                    </td>
                    <td class="text-end">
                      {% if user.is_superuser or 'Admin' in user_groups %}
                      <div class="btn-group" role="group">
                        <a href="{% url 'reports:edit-student' student.pk %}" class="btn btn-sm btn-outline-primary">
                          <i class="fas fa-edit"></i>
                        </a>
                        <a href="{% url 'reports:delete-student' student.pk %}" class="btn btn-sm btn-outline-danger">
                          <i class="fas fa-trash"></i>
                        </a>
                      </div>
                      {% else %}
                        <span class="text-muted">—</span>
                      {% endif %}
                    </td>
                    <td class="text-end">
                      <a href="{% url 'reports:create-report' %}?student_id={{ student.pk }}" class="btn btn-sm btn-success">
                        <i class="fas fa-plus-circle"></i> Report
                      </a>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="alert alert-info text-center py-4">
            <i class="fas fa-inbox" style="font-size: 2rem; color: #667eea;"></i>
            <p class="mt-3 mb-0">
              No students found.
              {% if user.is_superuser or 'Admin' in user_groups %}
                <a href="{% url 'create-student' %}">Create one now</a>
              {% endif %}
            </p>
          </div>
        {% endif %}
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
