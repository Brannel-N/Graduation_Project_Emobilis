<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}DMS Admin{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
      :root{
        --sidebar-bg: linear-gradient(180deg,#2d3e50 0%, #1f2a37 100%);
        --accent: #667eea;
      }
      body { 
        background: #f1f5f9; 
        min-height: 100vh;
      }
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      .navbar-brand { font-weight: 700; }
      .admin-sidebar { min-width: 230px; }
      .content-wrapper { padding-top: 24px; }

      /* Sidebar styling */
      .admin-sidebar{
        background: var(--sidebar-bg);
        color: #e6eef8;
        box-shadow: 2px 0 6px rgba(16,24,40,0.05);
        height: 100vh;
        position: sticky;
        top: 0;
      }
      .admin-sidebar .nav-link{
        color: rgba(230,238,248,0.9);
        padding: 12px 14px;
        border-radius: 8px;
        margin: 6px 4px;
        display:flex;
        align-items:center;
        gap:10px;
      }
      .admin-sidebar .nav-link .fa,
      .admin-sidebar .nav-link .fas{
        width:20px;
        text-align:center;
        color: rgba(230,238,248,0.9);
      }
      .admin-sidebar .nav-link:hover{
        background: rgba(255,255,255,0.04);
        color: white;
        transform: translateY(-1px);
      }
      .admin-sidebar .nav-link.active{
        background: linear-gradient(90deg,var(--accent), #764ba2);
        color: white;
        box-shadow: 0 6px 18px rgba(102,126,234,0.18);
      }
      .admin-user{
        display:flex;
        align-items:center;
        gap:12px;
        padding: 16px;
      }
      .admin-user img{
        width:44px;height:44px;border-radius:50%;object-fit:cover;border:2px solid rgba(255,255,255,0.08);
      }
      .admin-user .meta{
        line-height:1;
      }
      .admin-user .meta .name{font-weight:700;color:#fff}
      .admin-user .meta .role{font-size:12px;color:rgba(230,238,248,0.8)}
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
      <div class="container-fluid">
        <a class="navbar-brand ms-3" href="/">DMS Admin</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto me-3 align-items-center">
            <li class="nav-item"><a class="nav-link" href="/accounts/dashboard/admin/">Dashboard</a></li>
            <li class="nav-item"><a class="nav-link" href="/accounts/admin/users/">Users</a></li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userMenu" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                {% if user_profile_picture %}
                  <img src="{{ user_profile_picture }}" alt="avatar" style="width:38px;height:38px;border-radius:50%;object-fit:cover;border:2px solid #eee;" class="me-2">
                {% else %}
                  <span class="badge bg-secondary rounded-circle me-2" style="width:38px;height:38px;display:inline-flex;align-items:center;justify-content:center;color:#fff;">{{ request.user.first_name|default:request.user.username|slice:":1"|upper }}</span>
                {% endif %}
                <span class="d-none d-md-inline">{{ request.user.get_short_name|default:request.user.username }}</span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
                <li><a class="dropdown-item" href="{% url 'profile' %}"><i class="fas fa-user-circle me-2"></i>Profile</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="{% url 'logout' %}"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container-fluid p-0">
      <div class="row g-0 min-vh-100">
        <aside class="col-md-2 d-none d-md-block admin-sidebar border-end pt-3 d-flex flex-column">
          <div class="admin-user px-2 mb-2">
            {% if request.user.is_authenticated %}
              {% if request.user.first_name %}
                <div class="avatar-placeholder rounded-circle bg-light text-dark d-flex align-items-center justify-content-center" style="width:44px;height:44px;font-weight:700">{{ request.user.first_name|slice:":1"|upper }}</div>
              {% else %}
                <div class="avatar-placeholder rounded-circle bg-light text-dark d-flex align-items-center justify-content-center" style="width:44px;height:44px;font-weight:700">{{ request.user.username|slice:":1"|upper }}</div>
              {% endif %}
              <div class="meta">
                <div class="name">{% if request.user.first_name %}{{ request.user.first_name }} {{ request.user.last_name }}{% else %}{{ request.user.username }}{% endif %}</div>
                <div class="role">
                  {% with groups=request.user.groups.all %}
                    {% if request.user.is_superuser %}Administrator{% elif groups %}{{ groups.0.name }}{% else %}User{% endif %}
                  {% endwith %}
                </div>
              </div>
            {% endif %}
          </div>

          <nav class="nav flex-column px-2">
            <a class="nav-link" href="/accounts/dashboard/admin/"><i class="fas fa-tachometer-alt me-2"></i>Dashboard</a>
            <a class="nav-link" href="/accounts/admin/users/"><i class="fas fa-users me-2"></i>Users</a>
            <a class="nav-link" href="/reports/"><i class="fas fa-file-alt me-2"></i>Reports</a>
          </nav>
          <div class="mt-auto p-3 text-start ">
            <i class="fas fa-shield-alt me-1"></i> Secure Admin Area
          </div>
        </aside>

        <main class="col-md-10 content-wrapper p-4" style="overflow-y: auto;">
          <div class="container-fluid">
            {% if messages %}
              <div class="mb-3">
                {% for message in messages %}
                  <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                  </div>
                {% endfor %}
              </div>
            {% endif %}

            {% block content %}{% endblock %}
          </div>
        </main>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
